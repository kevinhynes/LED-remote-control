#:import FakeDevice components.FakeDevice

<Overlay@Widget>:
    canvas:
        Color:
            rgba: 1, 0, 0, 0.25
        Rectangle:
            pos: self.pos
            size: self.size
    # This works for KivyMD widgets:
    md_bg_color: app.theme_cls.primary_light
    md_bg_color: (1, 0, 0, 0.25)
    md_bg_color: 'palegreen'
    # string values must match https://www.w3.org/TR/SVG11/types.html#ColorKeywords

# Note: Padding adds space between the border of a layout and its widgets.
# VariableListProperty defaults to [0, 0, 0, 0].
# [padding_left, padding_top, padding_right, padding_bottom] or
# [padding_horizontal, padding_vertical] or
# [padding]


<TestButton@MDRectangleFlatButton>:
    md_bg_color: app.theme_cls.primary_light


<BTDeviceListItem>:
    IconLeftWidgetWithoutTouch:
        icon: 'bluetooth'


<FindDevicesScreen>:
    available_devices: app.available_devices
    bonded_devices: app.bonded_devices
    available_device_list: _available_devices_list
    bonded_devices_list: _bonded_devices_list

    MDScrollView:
        MDList:
            OneLineListItem:
                text: 'Paired Devices'.upper()
                font_style: 'Button'
                _no_ripple_effect: True
            MDSeparator:
            MDList:
                id: _bonded_devices_list
            OneLineListItem:
                text: 'Available Devices'.upper()
                font_style: 'Button'
                _no_ripple_effect: True
            MDSeparator:
            MDList:
                id: _available_devices_list


<ControlScreen>:
    connected_devices: app.connected_devices
    connected_devices_list: _connected_devices_list
    md_bg_color: app.theme_cls.bg_light

    MDScrollView:
        do_scroll_x: False
        scroll_distance: dp(300)
#        scroll_timeout: 250
        MDList:
            id: _connected_devices_list
            spacing: dp(20)
            DeviceController:
            DeviceController:
            DeviceController:
            DeviceController:


<DeviceInfoScreen>:
    info_list: _info_list
    MDScrollView:
        do_scroll_x: False
        scroll_distance: dp(300)
#        scroll_timeout: 250
        MDList:
            id: _info_list
            MDSeparator:
                height: dp(3)

<MainScreen>:
    MDBoxLayout:
        size_hint: (1, 1)
        orientation: 'horizontal'
        MDBoxLayout:
            orientation: 'vertical'
            TestButton:
                size_hint: (1, 1)
                text: 'Send String - On'
                on_press: app.send(1, 1)
            MDRectangleFlatButton:
                size_hint: (1, 1)
                text: 'Send String - Blue'
                on_press: app.send(1, 2)
            MDRectangleFlatButton:
                size_hint: (1, 1)
                text: 'Send String - Red'
                on_press: app.send(1, 3)
        MDBoxLayout:
            orientation: 'vertical'
            TestButton:
                size_hint: (1, 1)
                text: 'Send String - Off'
                on_press: app.send(1, 0)
            MDRectangleFlatButton:
                size_hint: (1, 1)
                text: 'Send String - Green'
                on_press: app.send(1, 4)
            MDRectangleFlatButton:
                size_hint: (1, 1)
                text: 'Send String - Spare - Off'
                on_press: app.send(1, 0)


<RootScreen>:
    name: 'root'
    screen_manager: _screen_manager

    MDTopAppBar:
        id: _top_app_bar
        title: 'LED Remote Control'
        anchor_title: 'left'
        elevation: 4
        shadow_color: app.theme_cls.bg_darkest
        pos_hint: {'top': 1}
        left_action_items: [['menu', lambda x: _nav_drawer.set_state('open')]]

    MDNavigationLayout:

        MDScreenManager:
            id: _screen_manager

            ControlScreen:
                name: 'connected_devices'
                size_hint_y: 1 - _top_app_bar.height / root.height
                pos_hint_y: {'y': 0}

            FindDevicesScreen:
                name: 'find_devices'
                size_hint_y: 1 - _top_app_bar.height / root.height

            MainScreen:
                name: 'main'
                size_hint_y: 1 - _top_app_bar.height / root.height

            DeviceInfoScreen
                name: 'device_info'
                size_hint_y: 1 - _top_app_bar.height / root.height

        MDNavigationDrawer:
            id: _nav_drawer
            enable_swiping: False
            radius: (0, 16, 16, 0)

            MDNavigationDrawerMenu:

                MDNavigationDrawerHeader:
                    title: 'LED Remote Control'
                    spacing: '4dp'
                    padding: '12dp', 0, 0, '56dp'

                MDNavigationDrawerLabel:
                    text: 'Clickable Items'

                MDNavigationDrawerItem:
                    icon: 'magnify'
                    text: 'Find Devices'
                    on_press:
                        _screen_manager.current = 'find_devices'
                        _nav_drawer.set_state('close')
                        # app.start_discovery()
                        app.get_bonded_devices()

                MDNavigationDrawerItem:
                    icon: 'bluetooth'
                    text: 'Connected Devices'
                    on_press:
                        _screen_manager.current = 'connected_devices'
                        _nav_drawer.set_state('close')

                MDNavigationDrawerItem:
                    icon: 'bluetooth'
                    text: 'Main'
                    on_press:
                        _screen_manager.current = 'main'
                        _nav_drawer.set_state('close')

                MDNavigationDrawerDivider:

                MDNavigationDrawerLabel:
                    text: 'Labels'

                MDNavigationDrawerItem:
                    icon: 'information-outline'
                    text: 'Label'

                MDNavigationDrawerItem:
                    icon: 'information-outline'
                    text: 'Label'
