<Overlay@Widget>:
    canvas:
        Color:
            rgba: 1, 0, 0, 0.25
        Rectangle:
            pos: self.pos
            size: self.size
    # This works for KivyMD widgets:
    md_bg_color: app.theme_cls.primary_light
    md_bg_color: (1, 0, 0, 0.25)
    md_bg_color: 'palegreen'
    # https://www.w3.org/TR/SVG11/types.html#ColorKeywords

<TestButton@MDRectangleFlatButton>:
    md_bg_color: app.theme_cls.primary_light


<BTDeviceListItem>:
    IconLeftWidgetWithoutTouch:
        icon: 'bluetooth'


<DeviceConnectionDialog>:
    radius: 20, 10, 20, 10
    adaptive_height: True


<DialogContent>:
    label: _label
    status_container: _status_container
    orientation: 'horizontal'
    size_hint: (1, 1)
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    adaptive_height: True
#    md_bg_color: app.theme_cls.primary_light
    md_bg_color: (0, 0, 1, 0.25)
    radius: 20, 10, 20, 10
    padding: 5, 5, 5, 5
    TestLabel:
        id: _label
        size_hint: (0.8, None)
        height: self.texture_size[1]
        halign: 'left'
        valign: 'middle'
        pos_hint: {'left': 0, 'center_y': 0.5}
    StatusContainer:
        id: _status_container
        size_hint: (0.2, 1)
        pos_hint: {'right': 1, 'center_y': 0.5, 'center_x': 0.5}


<StatusSpinner>:
    size_hint: (None, None)
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    active: True


<SuccessIcon>:
    size_hint: (None, None)
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    _no_ripple_effect: True
    theme_text_color: 'Custom'
    text_color: 0, 1, 0, 1
    icon: 'checkbox-marked-circle'
#    icon: 'check-outline'
#    icon: 'cellphone-check'
#    icon: 'lan-check'
#    icon: 'wifi-check'
#    icon: 'swap-vertical'
#    icon: 'remote'
#    icon: 'pipe'
#    icon: 'led-on'
#    icon: 'leak'
#    icon: 'globe-light-outline'
#    icon: 'flashlight'
#    icon: 'desk-lamp-on'
#    icon: 'connection'
#    icon: 'alarm-light'
    overlay_color: (1, 1, 1, 0)
    on_release: self.overlay_color_ = (0, 1, 0, 1)


<FailIcon>:
    size_hint: (None, None)
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    _no_ripple_effect: True
    theme_text_color: 'Custom'
    text_color: 0.5, 0, 0, 1
    icon: 'close'
    # icon: 'close-outline'
    # icon: 'close-circle-outline'
    # icon: 'window-close'
    # icon: 'thumb-down'
    # icon: 'thumb-down-outline'
    # icon: 'sync-off'
    # icon: 'skull-crossbones'
    # icon: 'share-off'
    # icon: 'remote-off'
    # icon: 'pipe-disconnected'
    # icon: 'minus-circle'
    # icon: 'led-variant-off'
    # icon: 'google-downasaur'
    # icon: 'flashlight-off'
    # icon: 'desk-lamp-off'
    # icon: 'alarm-light-off'


<DeviceController>:
#    power_button: _power_button
#    dimmer: _dimmer
#    ripple_scale: 0
    _no_ripple_effect: True
    divider: None
    radius: dp(20), dp(20), dp(20), dp(20)

    MDCard:
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        size_hint: (0.9, 1)
        radius: dp(20), dp(20), dp(20), dp(20)
        style: 'outlined'
        orientation: 'vertical'
#        padding: dp(10), dp(10), dp(10), dp(10)
#        adaptive_height: True
#        md_bg_color: app.theme_cls.primary_light
#        border_color: (0.5, 0.5, 0, 1)
#        border_width: 1
#        MDLabel:
#            size_hint: (1, None)
#            height: dp(50)
#            padding: dp(20), dp(0)
#            md_bg_color: app.theme_cls.primary_dark
#            text: root.device.alias
##            radius: self.height / 2
#            pos_hint_y: {'top': 1}
#        MDBoxLayout:
#            orientation: 'horizontal'
#            spacing: dp(20)
#            padding: dp(20), dp(15)
#            adaptive_height: True
#
#            MDIconButton:
#                id: _power_button
#                icon: 'power'
#                line_color: (1, 0, 0, 1)
#                md_bg_color: app.theme_cls.bg_darkest
#                on_press: root.power()
#
#            MDSlider:
#                id: _dimmer
#                hint: False
#                min: 0
#                max: 100
#                size_hint_y: None
#                height: dp(50)
#                on_value: root.dim(self)
#                disabled: False


<FindDevicesScreen>:
    available_devices: app.available_devices
    bonded_devices: app.bonded_devices
    available_device_list: _available_devices_list
    bonded_devices_list: _bonded_devices_list

    MDScrollView:
        MDList:
            OneLineListItem:
                text: 'Paired Devices'.upper()
                font_style: 'Button'
                _no_ripple_effect: True
            MDSeparator:
            MDList:
                id: _bonded_devices_list
            OneLineListItem:
                text: 'Available Devices'.upper()
                font_style: 'Button'
                _no_ripple_effect: True
            MDSeparator:
            MDList:
                id: _available_devices_list


<ControlScreen>:
    connected_devices: app.connected_devices
    connected_devices_list: _connected_devices_list
    MDScrollView:
        do_scroll_x: False
#        scroll_distance: dp(300)
#        scroll_timeout: 250
#        MDList:
#            md_bg_color: app.theme_cls.primary_light
#            OneLineListItem:
#                text: 'Test'.upper()
#                font_style: 'Button'
        MDList:
            id: _connected_devices_list
            spacing: dp(20)
            DeviceController:
            DeviceController:
            DeviceController:


<MainScreen>:
    MDBoxLayout:
        size_hint: (1, 1)
        orientation: 'horizontal'
        MDBoxLayout:
            orientation: 'vertical'
            TestButton:
                size_hint: (1, 1)
                text: 'Send String - On'
                on_press: app.send('1')
            MDRectangleFlatButton:
                size_hint: (1, 1)
                text: 'Send String - Blue'
                on_press: app.send('2')
            MDRectangleFlatButton:
                size_hint: (1, 1)
                text: 'Send String - Red'
                on_press: app.send('3')
        MDBoxLayout:
            orientation: 'vertical'
            TestButton:
                size_hint: (1, 1)
                text: 'Send String - Off'
                on_press: app.send('0')
            MDRectangleFlatButton:
                size_hint: (1, 1)
                text: 'Send String - Green'
                on_press: app.send('4')
            MDRectangleFlatButton:
                size_hint: (1, 1)
                text: 'Send String - Spare - Off'
                on_press: app.send('0')


<RootScreen>:
    name: 'root'
    screen_manager: _screen_manager

    MDTopAppBar:
        id: _top_app_bar
        title: 'LED Remote Control'
        anchor_title: 'left'
        elevation: 4
        shadow_color: app.theme_cls.bg_darkest
        pos_hint: {'top': 1}
        left_action_items: [['menu', lambda x: _nav_drawer.set_state('open')]]

    MDNavigationLayout:

        MDScreenManager:
            id: _screen_manager

            ControlScreen:
                name: 'connected_devices'
                size_hint_y: 1 - _top_app_bar.height / root.height
                pos_hint_y: {'y': 0}

            FindDevicesScreen:
                name: 'find_devices'
                size_hint_y: 1 - _top_app_bar.height / root.height

            MainScreen:
                name: 'main'
                size_hint_y: 1 - _top_app_bar.height / root.height

        MDNavigationDrawer:
            id: _nav_drawer
            enable_swiping: False
            radius: (0, 16, 16, 0)

            MDNavigationDrawerMenu:

                MDNavigationDrawerHeader:
                    title: 'LED Remote Control'
                    spacing: '4dp'
                    padding: '12dp', 0, 0, '56dp'

                MDNavigationDrawerLabel:
                    text: 'Clickable Items'

                MDNavigationDrawerItem:
                    icon: 'magnify'
                    text: 'Find Devices'
                    on_press:
                        _screen_manager.current = 'find_devices'
                        _nav_drawer.set_state('close')
                        # app.start_discovery()
                        app.get_bonded_devices()

                MDNavigationDrawerItem:
                    icon: 'bluetooth'
                    text: 'Connected Devices'
                    on_press:
                        _screen_manager.current = 'connected_devices'
                        _nav_drawer.set_state('close')

                MDNavigationDrawerItem:
                    icon: 'bluetooth'
                    text: 'Main'
                    on_press:
                        _screen_manager.current = 'main'
                        _nav_drawer.set_state('close')

                MDNavigationDrawerDivider:

                MDNavigationDrawerLabel:
                    text: 'Labels'

                MDNavigationDrawerItem:
                    icon: 'information-outline'
                    text: 'Label'

                MDNavigationDrawerItem:
                    icon: 'information-outline'
                    text: 'Label'
