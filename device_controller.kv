#:import Command bluetooth_helpers.Command

<ColorPresetButton>:
    size_hint: (None, 0.9)
    width: self.height
    rounded_button: True
    line_color: app.theme_cls.bg_light
    line_width: dp(1.1)


<RenameDeviceTextField>:
    size_hint: (None, None)
    mode: 'rectangle'
    helper_text: 'Rename your device'
    helper_text_mode: 'persistent'
    helper_text_color_normal: 'white'
    helper_text_color_focus: 'white'
    text_color_normal: 'white'
    text_color_focus: 'white'


<DeviceController>:
    id: device_controller_
    power_button: power_button_
    dimmer: dimmer_
    red_slider: red_slider_
    green_slider: green_slider_
    blue_slider: blue_slider_
    carousel: carousel_
    dimmer_container: dimmer_container_
    rgb_container: rgb_container_
    off_screen: off_screen_
    _no_ripple_effect: True
    divider: None
    radius: dp(15), dp(15), dp(15), dp(15)
    height: dp(165)

    MDCard:
        id: card_
        orientation: 'vertical'
        size_hint: (0.9, 1)
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        style: 'elevated'
        elevation: dp(4)
        padding: dp(10), dp(10), dp(10), dp(10)
        radius: dp(15), dp(15), dp(15), dp(15)
        md_bg_color: app.theme_cls.primary_color

        MDRelativeLayout:
            # Add card_bottom first so the shadow effect works. Use RelativeLayout to position
            # the sections correctly.

            MDCard:
                id: card_bottom_
                orientation: 'horizontal'
                pos_hint: {'top': 1}
                size_hint: (1, None)
                height: dp(100)
                padding: dp(20), dp(0)
                spacing: dp(10)
                style: 'elevated'
                elevation: dp(2)
                radius: dp(15), dp(15), dp(15), dp(15)
                md_bg_color: app.theme_cls.primary_light
                MDIconButton:
                    id: left_btn_
                    pos_hint: {'left': 0, 'center_y': (card_bottom_.height - card_top_.height) / (2 * card_bottom_.height)}
                    size_hint: (0.05, 0.5)
                    icon: 'chevron-left'
                    theme_icon_color: 'Custom'
                    icon_color: 'white'
                    _no_ripple_effect: True
                    on_release: root.expand_rgb_sliders()
                MDBoxLayout:
                    id: carousel_
                    adaptive_height: True
                    orientation: 'vertical'
                    size_hint: (1, 1)
#                    md_bg_color: (1, 0, 0, 0.5)
                    MDBoxLayout:
                        id: dimmer_container_
                        orientation: 'vertical'
#                        md_bg_color: (1, 0, 0, 0.5)
                        MDSlider:
                            id: dimmer_
                            pos_hint: {'bottom': 0}
                            size_hint: (1, None)
                            height: dp(50)
                            hint: False
                            show_off: False
                            min: 0
                            max: 255
                            step: 1
                            on_value: root.dim(self)
                    MDBoxLayout:
                        id: rgb_container_
                        orientation: 'vertical'
#                        md_bg_color: (0.2, 1, 0, 0.5)
                        MDSlider:
                            id: red_slider_
                            color: (0.8, 0, 0, 0.75)
                            thumb_color_active: (0.8, 0, 0, 0.75)
                            thumb_color_inactive: (0.8, 0, 0, 0.75)
                            thumb_color_disabled: (0.8, 0, 0, 0.75)
                            size_hint: (1, None)
                            height: dp(50)
                            hint: False
                            show_off: False
                            min: 0
                            max: 255
                            step: 1
                            value: 255
                            disabled: True
                            on_value: root.send_rgb()
                        MDSlider:
                            id: green_slider_
                            color: (0, 0.8, 0, 0.75)
                            thumb_color_active: (0, 0.8, 0, 0.75)
                            thumb_color_inactive: (0, 0.8, 0, 0.75)
                            thumb_color_disabled: (0, 0.8, 0, 0.75)
                            size_hint: (1, None)
                            height: dp(50)
                            hint: False
                            show_off: False
                            min: 0
                            max: 255
                            step: 1
                            value: 255
                            disabled: True
                            on_value: root.send_rgb()
                        MDSlider:
                            id: blue_slider_
                            color: (0, 0, 0.8, 0.75)
                            thumb_color_active: (0, 0, 0.8, 0.75)
                            thumb_color_inactive: (0, 0, 0.8, 0.75)
                            thumb_color_disabled: (0, 0, 0.8, 0.75)
                            size_hint: (1, None)
                            height: dp(50)
                            hint: False
                            show_off: False
                            min: 0
                            max: 255
                            step: 1
                            value: 255
                            disabled: True
                            on_value: root.send_rgb()
                        MDBoxLayout:
                            id: color_presets_container_

                MDIconButton:
                    id: right_btn_
                    pos_hint: {'right': 1, 'center_y': (card_bottom_.height - card_top_.height) / (2 * card_bottom_.height)}
                    size_hint: (0.05, 0.5)
                    icon: 'chevron-right'
                    theme_icon_color: 'Custom'
                    icon_color: 'white'
                    _no_ripple_effect: True
                    on_release: root.expand_rgb_sliders()

            MDCard:
                id: card_top_
                orientation: 'horizontal'
                pos_hint: {'top': 1}
                size_hint: (1, None)
                height: dp(50)
                style: 'elevated'
                elevation: dp(2)
                radius: dp(15), dp(15), dp(15), dp(15)
                md_bg_color: app.theme_cls.primary_dark

                MDRelativeLayout:
                    id: _status_container
                    size_hint: (0.1, 1)

                    MDIconButton:
                        id: status_icon_
                        icon: 'bluetooth-off'
                        theme_icon_color: 'Custom'
                        icon_color: 'red'

                MDRelativeLayout:
                    id: label__container
                    size_hint: (0.65, 1)

                    MDLabel:
                        id: label_
                        padding: dp(20), dp(0)
                        text: root.device.nickname if root.device.nickname else root.device.getName()
                        text_size: self.size
                        valign: 'middle'

                MDBoxLayout:
                    size_hint: (0.25, 1)

                    MDSwitch:
                        id: power_button_
                        pos_hint: {'right': 1, 'center_y': 0.5}
                        widget_style: 'ios'
                        width: dp(45)
                        on_active: root.power()

                MDFloatLayout:
                    # MDSwitch widget_style: 'ios' and material design 'M3' versions' right
                    # side extends outside of the widget's boundary. Including this layout
                    # as padding to make it look right.
                    size_hint: (0.1, 1)

            MDBoxLayout:
                id: presets_
                pos_hint: {'bottom': 0}
                size_hint: (1, None)
                height: dp(40)
                orientation: 'horizontal'
                spacing: dp(7)
                padding: dp(10), dp(2), dp(0), dp(2)
#                md_bg_color: (1, 0, 0, 0.25)

                ColorPresetButton:
                    # White
                    md_bg_color: (1, 1, 1, 1)
                    on_release: root.update_rgb_sliders(self.md_bg_color)

                ColorPresetButton:
                    # Red
                    md_bg_color: (1, 0, 0, 1)
                    on_release: root.update_rgb_sliders(self.md_bg_color)
#                    on_release: root.send_command(Command(mode=1, red=255, green=0, blue=0))

                ColorPresetButton:
                    # Orange
                    md_bg_color: (1, 0.64, 0, 1)
                    on_release: root.update_rgb_sliders(self.md_bg_color)
#                    on_release: root.send_command(Command(mode=1, red=255, green=140, blue=0))

                ColorPresetButton:
                    # Yellow
                    md_bg_color: (1, 1, 0, 1)
                    on_release: root.update_rgb_sliders(self.md_bg_color)
#                    on_release: root.send_command(Command(mode=1, red=255, green=255, blue=0))

                ColorPresetButton:
                    # Green
                    md_bg_color: (0, 1, 0, 1)
                    on_release: root.update_rgb_sliders(self.md_bg_color)
#                    on_release: root.send_command(Command(mode=1, red=0, green=255, blue=0))

#                ColorPresetButton:
#                    # Blue
#                    md_bg_color: (0, 0, 1, 1)
#                    on_release: root.send(1, 6)

                MDIconButton:
                    # Testing comet animation
                    icon: "data/comet.png"
#                    size_hint:  (None, None)
#                    font_size: sp(100)
                    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                    size_hint: (None, 0.9)
                    width: self.height
                    rounded_button: True
                    line_color: app.theme_cls.bg_light
                    line_width: dp(1.1)

                MDRelativeLayout:
                    MDIconButton:
                        id: menu_button_
                        icon: 'dots-vertical'
                        icon_size: dp(20)
                        pos_hint: {'center_x': .75, 'center_y': 0.45}
                        ripple_alpha: 0.5
#                        ripple_scale: 0.5
                        on_release: root.open_options_menu(self)

    MDRelativeLayout:
        id: card_overlay_
        size_hint: (0.9, 1)
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        radius: dp(15), dp(15), dp(15), dp(15)
#        md_bg_color: app.theme_cls.primary_color
        md_bg_color: 'gray'
        opacity: 0
    MDRelativeLayout:
        id: off_screen_
        x: root.right + dp(100)
        md_bg_color: (1, 0, 0, 0.5)