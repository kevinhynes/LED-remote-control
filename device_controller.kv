<ColorPresetButton>:
    size_hint: (None, 0.9)
    width: self.height
#    md_bg_color: (0.2, 0.1, 0.7, 0.25)
    rounded_button: True
    line_color: app.theme_cls.bg_light
    line_width: dp(1.1)


<RenameDeviceTextField>:
    size_hint: (None, None)
    mode: 'rectangle'
    helper_text: 'Rename your device'
    helper_text_mode: 'persistent'
    helper_text_color_normal: 'white'
    helper_text_color_focus: 'white'
    text_color_normal: 'white'
    text_color_focus: 'white'


<DeviceController>:
    power_button: power_button_
    dimmer: dimmer_
    red_slider: red_slider_
    green_slider: green_slider_
    blue_slider: blue_slider_
    _no_ripple_effect: True
    divider: None
    radius: dp(15), dp(15), dp(15), dp(15)
    height: dp(165)

    MDCard:
        id: _card
        orientation: 'vertical'
        size_hint: (0.9, 1)
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        style: 'elevated'
        elevation: dp(4)
        padding: dp(10), dp(10), dp(10), dp(10)
        radius: dp(15), dp(15), dp(15), dp(15)
        md_bg_color: app.theme_cls.primary_color

        MDRelativeLayout:
            # Add card_bottom first so the shadow effect works. Use RelativeLayout to position
            # the sections correctly.

            MDCard:
                id: card_bottom_
                orientation: 'horizontal'
                pos_hint: {'top': 1}
                size_hint: (1, None)
                height: dp(100)
                padding: dp(20), dp(0)
                style: 'elevated'
                elevation: dp(2)
                radius: dp(15), dp(15), dp(15), dp(15)
                md_bg_color: app.theme_cls.primary_light

                MDBoxLayout:
                    id: slider_container_
                    adaptive_height: True
                    orientation: 'vertical'
#                    md_bg_color: (1, 0, 0, 0.5)

                    MDSlider:
                        id: dimmer_
                        pos_hint: {'bottom': 0}
                        size_hint: (1, None)
                        height: dp(50)
                        hint: False
                        show_off: False
                        min: 0
                        max: 100
                        step: 1
                        on_value: root.dim(self)
                    MDSlider:
                        id: red_slider_
                        color: (0.8, 0, 0, 0.75)
                        thumb_color_active: (0.8, 0, 0, 0.75)
                        thumb_color_inactive: (0.8, 0, 0, 0.75)
                        thumb_color_disabled: (0.8, 0, 0, 0.75)
                        size_hint: (1, None)
                        height: dp(50)
                        hint: False
                        show_off: False
                        min: 0
                        max: 255
                        step: 1
                        disabled: True
                    MDSlider:
                        id: green_slider_
                        color: (0, 0.8, 0, 0.75)
                        thumb_color_active: (0, 0.8, 0, 0.75)
                        thumb_color_inactive: (0, 0.8, 0, 0.75)
                        thumb_color_disabled: (0, 0.8, 0, 0.75)
                        size_hint: (1, None)
                        height: dp(50)
                        hint: False
                        show_off: False
                        min: 0
                        max: 255
                        step: 1
                        disabled: True
                    MDSlider:
                        id: blue_slider_
                        color: (0, 0, 0.8, 0.75)
                        thumb_color_active: (0, 0, 0.8, 0.75)
                        thumb_color_inactive: (0, 0, 0.8, 0.75)
                        thumb_color_disabled: (0, 0, 0.8, 0.75)
                        size_hint: (1, None)
                        height: dp(50)
                        hint: False
                        show_off: False
                        min: 0
                        max: 255
                        step: 1
                        disabled: True

                MDIconButton:
                    id: expand_btn_
                    icon: 'chevron-down'
                    theme_icon_color: 'Custom'
                    icon_color: 'white'
                    on_release: root.expand_rgb_sliders()

            MDCard:
                id: _card_top
                orientation: 'horizontal'
                pos_hint: {'top': 1}
                size_hint: (1, None)
                height: dp(50)
                style: 'elevated'
                elevation: dp(2)
                radius: dp(15), dp(15), dp(15), dp(15)
                md_bg_color: app.theme_cls.primary_dark

                MDRelativeLayout:
                    id: _status_container
                    size_hint: (0.1, 1)

                    MDIconButton:
                        id: _status_icon
                        icon: 'circle-medium'
                        theme_icon_color: 'Custom'
                        icon_color: 'red'

                MDRelativeLayout:
                    id: _label_container
                    size_hint: (0.65, 1)

                    MDLabel:
                        id: _label
        #                height: self.texture_size[1] + dp(20)
                        padding: dp(20), dp(0)
                        text: root.device.nickname if root.device.nickname else root.device.getName()
                        text_size: self.size
                        valign: 'middle'

                MDBoxLayout:
                    size_hint: (0.25, 1)

                    MDSwitch:
                        id: power_button_
                        pos_hint: {'right': 1, 'center_y': 0.5}
                        widget_style: 'ios'
                        width: dp(45)
                        on_active: root.power()

                MDFloatLayout:
                    # MDSwitch widget_style: 'ios' and material design 'M3' versions' right
                    # side extends outside of the widget's boundary. Including this layout
                    # as padding to make it look right.
                    size_hint: (0.1, 1)

            MDBoxLayout:
                id: _presets
                pos_hint: {'bottom': 0}
                size_hint: (1, None)
                height: dp(40)
                orientation: 'horizontal'
                spacing: dp(7)
                padding: dp(10), dp(2), dp(0), dp(2)
#                md_bg_color: (1, 0, 0, 0.25)

                ColorPresetButton:
                    # White
                    md_bg_color: (1, 1, 1, 1)
                    on_release: root.send(1, 1)

                ColorPresetButton:
                    # Red
                    md_bg_color: (1, 0, 0, 1)
                    on_release: root.send(1, 2)

                ColorPresetButton:
                    # Orange
                    md_bg_color: (1, 0.64, 0, 1)
                    on_release: root.send(1, 3)

                ColorPresetButton:
                    # Yellow
                    md_bg_color: (1, 1, 0, 1)
                    on_release: root.send(1, 4)

                ColorPresetButton:
                    # Green
                    md_bg_color: (0, 1, 0, 1)
                    on_release: root.send(1, 5)

                ColorPresetButton:
                    # Blue
                    md_bg_color: (0, 0, 1, 1)
                    on_release: root.send(1, 6)

                MDRelativeLayout:
                    MDIconButton:
                        id: _menu_button
                        icon: 'dots-vertical'
                        icon_size: dp(20)
                        pos_hint: {'center_x': .75, 'center_y': 0.45}
                        ripple_alpha: 0.5
#                        ripple_scale: 0.5
                        on_release: root.open_options_menu(self)

    MDRelativeLayout:
        id: _card_overlay
        size_hint: (0.9, 1)
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
        radius: dp(15), dp(15), dp(15), dp(15)
#        md_bg_color: app.theme_cls.primary_color
        md_bg_color: 'gray'
        opacity: 0
    MDRelativeLayout:
        id: off_screen_
        x: root.right + dp(100)
        md_bg_color: (1, 0, 0, 0.5)